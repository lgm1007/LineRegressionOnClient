<!doctype html>
<html>
<head>
    <title>TF.js regression test</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
    <script type="text/javascript">
       function createPredict() {
            // Get input value
            var ys1 = parseInt(document.getElementById('ys1').value);
            var ys2 = parseInt(document.getElementById('ys2').value);
            var ys3 = parseInt(document.getElementById('ys3').value);
            var ys4 = parseInt(document.getElementById('ys4').value);
            var ys5 = parseInt(document.getElementById('ys5').value);
            var ys6 = parseInt(document.getElementById('ys6').value);
            var ys7 = parseInt(document.getElementById('ys7').value);
            var ys8 = parseInt(document.getElementById('ys8').value);
            var ys9 = parseInt(document.getElementById('ys9').value);
            var ys10 = parseInt(document.getElementById('ys10').value);
            var epos = parseInt(document.getElementById('epos').value);
            var res = parseInt(document.getElementById('res').value);
            // training data
            const xs = tf.tensor([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], [10]);
            const ys = tf.tensor([ys1, ys2, ys3, ys4, ys5, ys6, ys7, ys8, ys9, ys10], [10]);

            // Linear regression
            var model = tf.sequential();
            model.add(tf.layers.dense({units: 1, inputShape: [1]}));

            // model compile
            model.compile({loss: 'meanSquaredError', optimizer: 'sgd'});

            var fitParam = {
                epochs: epos,
                callbacks: {
                    onEpochEnd:
                        function(epoch, logs) {
                            console.log('epoch', epoch, logs, 'RMSE : ',Math.sqrt(logs.loss));
                        }
                }
            }
            // Model training
            model.fit(xs, ys, fitParam).then(()=>{
                // Test data Inference
                for(var i = 1; i <= res; i++) {
                    let result = model.predict(tf.tensor([10 + i], [1])).arraySync();
                    // Create p tag
                    var resultPtag = document.createElement('p');
                    // Set p tag value on predict result
                    resultPtag.textContent = parseInt(result[0][0]);
                    // Append elements
                    document.body.appendChild(resultPtag);
                }
                //let result = model.predict(tf.tensor([11], [1])).arraySync();
                //document.getElementById('predict').innerHTML=result[0][0];
                
            });
       }
        
       // createPredict();
        
    </script>
</head>
<body>
    <h1>Tensorflow.js 선형회귀 테스트</h1>
    <hr/>
    <input type="number" id="ys1" value="0" /><br/>
    <input type="number" id="ys2" value="0" /><br/>
    <input type="number" id="ys3" value="0" /><br/>
    <input type="number" id="ys4" value="0" /><br/>
    <input type="number" id="ys5" value="0" /><br/>
    <input type="number" id="ys6" value="0" /><br/>
    <input type="number" id="ys7" value="0" /><br/>
    <input type="number" id="ys8" value="0" /><br/>
    <input type="number" id="ys9" value="0" /><br/>
    <input type="number" id="ys10" value="0" /><br/>
    훈련 횟수 : <input type="number" id="epos" value="500" /><br/>
    결과값 개수 : <input type="number" id="res" value="5" /><br/>
    <button type="button" id="start" onclick="createPredict();">예측시작</button>
    
</body>
</html>